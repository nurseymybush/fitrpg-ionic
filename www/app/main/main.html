<!--<ion-view title="" hide-back-button="true" ng-init="refresh()">-->
<!--chance change to stop refreshing alot-->
<ion-view title="" hide-back-button="true">

  <ion-nav-buttons side="left">
    <button menu-toggle="left" class="button button-icon icon-gray icon ion-navicon"></button>
  </ion-nav-buttons>

  <ion-nav-buttons side="right">
    <button class="button button-icon" ng-click="displayAlerts()" ng-show="alertCount"><span class="badge badge-assertive">{{alertCount}}</span></button>
    <button class="button button-icon icon-gray icon ion-star" ng-click="rateApp()"></button>
    <button class="button button-icon icon-gray icon ion-map" ng-click="navTo('quest')"></button>
    <button class="button button-icon icon-gray icon icon-fight" ng-click="navTo('battle')"></button>
  </ion-nav-buttons>

  <ion-content class="has-header dashboard">
    <ion-refresher pulling-text="Pull to refresh..." on-refresh="refresh()">
    </ion-refresher>

    <!-- new angular-bootstrap code to display alerts-->
    <div uib-alert ng-repeat="alert in alerts" ng-class="'alert-'+alert.type" ng-click="navTo('battle')" close="closeAlertsRefactored($index, alerts)"
      ng-show="showAlert">{{alert.msg}}</div>
    <div uib-alert ng-repeat="alert in levelUpAlerts" ng-class="'alert-'+alert.type" close="closeAlertsRefactored($index, levelUpAlerts)"
      ng-show="showAlert">{{alert.msg}}</div>
    <div uib-alert ng-repeat="alert in friendRequestAlerts" ng-class="'alert-'+alert.type" ng-click="navTo('friends')" close="closeAlertsRefactored($index, friendRequestAlerts)"
      ng-show="showAlert">{{alert.msg}}</div>
    <div uib-alert ng-repeat="alert in newItemAlerts" ng-class="'alert-'+alert.type" ng-click="navTo('shop')" close="closeAlertsRefactored($index, newItemAlerts)"
      ng-show="showAlert">{{alert.msg}}</div>
    <div uib-alert ng-repeat="alert in questAlerts" ng-class="'alert-'+alert.type" ng-click="navTo('quest')" close="closeAlertsRefactored($index, questAlerts)"
      ng-show="showAlert">{{alert.msg}}</div>

    <div class="list">
      <div class="card">
        <div class='item item-avatar item-main'>
          <img ng-src="{{user.profile.avatar}}">
          <h3>{{user.username}}</h3>
          <p>Level: {{user.attributes.level}} {{user.character}}</p>
        </div>

        <div class="item tabs tabs-secondary tabs-icon-left">
          <div class="tab-item tab-main-left">
            <span class="title-red">{{user.attributes.skillPts}} </span><span class="medium-text">Skill Points</span>
          </div>
          <div class="tab-item tab-main-right">
            <span class="title-red">{{user.attributes.gold}} </span><span class="medium-text">Gold</span>
          </div>
        </div>

        <div class="item row">
          <div class="col">
            <p>
              XP
              <span class="pull-right medium-text">{{calculatedData.currentXp}} / {{calculatedData.requiredXp}}</span>
            </p>
            <uib-progressbar max="100" value="(calculatedData.currentXp*100)/calculatedData.requiredXp"></uib-progressbar>
          </div>
        </div>

        <div class="item row" ng-click="goToPotions(user.attributes.HP,calculatedData.maxHp)">
          <div class="col">
            <p>
              HP
              <!--<span class="pull-right medium-text">{{user.attributes.HP}} / {{calculatedData.maxHp}}</span>-->
              <span class="pull-right medium-text">Base: {{calculatedData.vitality*vitalityMultiplier()}} | Bonus: {{user.bonusAttributes.HP}}</span>
            </p>
            <uib-progressbar max="100" value="(user.attributes.HP*100)/calculatedData.maxHp"><span style="color:white; white-space:nowrap;">{{user.attributes.HP + user.bonusAttributes.HP}} / {{calculatedData.maxHp}}</span></uib-progressbar>
          </div>
        </div>

        <div class="item row main-attributes">
          <div class="col" ng-click="applyAttributes('strength')">
            <i class="icon ion-plus-circled" ng-show="user.attributes.skillPts > 0"></i>
            <h1>{{calculatedData.strength}}</h1>
            <p>Strength</p>
          </div>
          <div class="col" ng-click="applyAttributes('vitality')">
            <i class="icon ion-plus-circled" ng-show="user.attributes.skillPts > 0"></i>
            <h1>{{calculatedData.vitality}}</h1>
            <p>Vitality</p>
          </div>
          <div class="col" ng-click="applyAttributes('endurance')">
            <i class="icon ion-plus-circled" ng-show="user.attributes.skillPts > 0"></i>
            <h1>{{calculatedData.endurance}}</h1>
            <p>Endurance</p>
          </div>
          <div class="col" ng-click="applyAttributes('dexterity')">
            <i class="icon ion-plus-circled" ng-show="user.attributes.skillPts > 0"></i>
            <h1>{{calculatedData.dexterity}}</h1>
            <p>Dexterity</p>
          </div>
        </div>

      </div>

      <div class="card" ng-click="navTo('inventory')">
        <div class="item card-title">
          What I'm Wielding
          <span class="item-icon-right">
            <i class="icon icon-anvil"></i>
          </span>
        </div>

        <div class="item list-heading">
          <h1>Weapons
          </h1>
          <div ng-show="isEquipped('weapon1')">
            <p>{{user.equipped.weapon1.name}}
            </p>
          </div>
          <div ng-show="isEquipped('weapon2')">
            <p>{{user.equipped.weapon2.name}}
            </p>
          </div>
        </div>

        <div class="item list-heading">
          <h1>Armor
          </h1>
          <div ng-show="isEquipped('armor')">
            <p>{{user.equipped.armor.name}}
            </p>
          </div>
        </div>

        <div class="item list-heading">
          <h1>Accessories
          </h1>
          <div ng-show="isEquipped('accessory1')">
            <p>{{user.equipped.accessory1.name}}
            </p>
          </div>
          <div ng-show="isEquipped('accessory2')">
            <p>{{user.equipped.accessory2.name}}
            </p>
          </div>
        </div>

      </div>

      <div class="card" ng-click="navTo('quest')">
        <div class="item card-title">
          Active Quests
          <span class="item-icon-right">
            <i class="icon icon-ion-map"></i>
          </span>
        </div>
        <div class="list">
          <div class="item row" ng-repeat="quest in user.quests | filter : {status: 'active'}">
              <div class="col">
              <p>
                {{quest.shortDesc}}
                <span class="pull-right medium-text">{{quest.winGoal}} / {{quest.winGoal}} {{quest.getObj.activity}}</span>
              </p>
              <uib-progressbar max="100" value="(quest.winGoal*100)/quest.winGoal"></uib-progressbar>
              </div>
          </div>
          <span class="item item-padding" ng-hide="(user.quests|filter:{status: 'active'}).length > 0">No Active Quests</span>
        </div>

      </div>

    </div>

  </ion-content>
</ion-view>